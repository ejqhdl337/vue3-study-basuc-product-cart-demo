<!DOCTYPE html>
<html>
  <head>
    <title>Splendid Food</title>
    <link rel="stylesheet" href="styles/style.min.css">
    <link rel="icon" href="../public/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../public/favicon.ico" type="image/ico">
  </head>
  <body>

    <div id="app">

      <header class="top-bar spread">
        <nav class="top-bar-nav">
          <a href="#" class="top-bar-link">
            <i class="icofont-spoon-and-fork"></i>
            <span>Home</span>
          </a>
          <a href="views/products.html" class="top-bar-link">
            <span>Products</span>
          </a>
          <a href="views/past-orders.html" class="top-bar-link">
            <span>Past Orders</span>
          </a>
        </nav>
        <a @click="toggleSidebar" class="top-bar-cart-link">
          <i class="icofont-cart-alt icofont-1x"></i>
          <span>Cart ({{cartCount}})</span>
        </a>
      </header>

      <div class="splash-container">
        <div class="splash">
          <h1>Splendid Food</h1>
        </div>
      </div>

      <main class="wrapper">

        <h2>Recommended</h2>

        <div class="recommended">

          <!-- <div class="card">
            <div class="card-title">
              Carrots
            </div>
            <div class="card-body">
              <i class="icofont-10x icofont-carrot"></i>
              <form>
                <div class="row">
                  <div class="cell">
                    <label>Type:</label>
                  </div>
                  <div class="cell">
                    <em>Vegetable</em>
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Price:</label>
                  </div>
                  <div class="cell">
                    $4.82
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Quantity:</label>
                  </div>
                  <div class="cell">
                    <input type="number" v-model.number="veges['Carrots'].inventory">
                  </div>
                </div>
              </form>
            </div>
            <div class="card-footer">
              <button @click="addToCart('Carrots')" class="btn btn-light">
                Add to cart
              </button>
            </div>
          </div>
		

          <div class="card">
            <div class="card-title">
              Pineapples
            </div>
            <div class="card-body">
              <i class="icofont-10x icofont-pineapple"></i>
              <form>
                <div class="row">
                  <div class="cell">
                    <label>Type:</label>
                  </div>
                  <div class="cell">
                    <em>Fruit</em>
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Price:</label>
                  </div>
                  <div class="cell">
                    $1.62
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Quantity:</label>
                  </div>
                  <div class="cell">
                    <input type="number" v-model="veges['pineapples'].inventory">
                  </div>
                </div>
              </form>
            </div>
            <div class="card-footer">
              <button class="btn btn-light">Add to cart</button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">
              Cherries
            </div>
            <div class="card-body">
              <i class="icofont-10x icofont-cherry"></i>
              <form>
                <div class="row">
                  <div class="cell">
                    <label>Type:</label>
                  </div>
                  <div class="cell">
                    <em>Fruit</em>
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Price:</label>
                  </div>
                  <div class="cell">
                    $1.04
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Quantity:</label>
                  </div>
                  <div class="cell">
                    <input type="number" v-model="veges['Cherries'].inventory">
                  </div>
                </div>
              </form>
            </div>
            <div class="card-footer">
              <button class="btn btn-light">Add to cart</button>
            </div>
          </div> -->
			
		<fruitcard v-for="vegetable in veges"
				   :vege="vegetable" />
			
        </div>

      </main>

      <footer>
      </footer>

    <sidebar v-if="sidebarVisible" 
			 :toggle="toggleSidebar" 
			 :vegeside="veges"
	/>
	</div>
      
    <script src="https://unpkg.com/vue@next"></script>
    <script>
      let app = Vue.createApp({
        data() {
          return {
			veges:[
				{
					name:'Carrot',
					type:'Vegetable',
					inventory:0,
					quantity:0,
					price:4.82,
					icon:'carrot'
				},
				{
					name:'Pineapples',
					type:'Fruit',
					inventory:0,
					quantity:0,
					price:1.62,
					icon:'pineapple'
				},
				{
					name:'Cherries',
					type:'Fruit',
					inventory:0,
					quantity:0,
					price:1.04,
					icon:'cherry'
				}
			],
			sidebarVisible:false,
          }
        },
        methods: {
			toggleSidebar(){
				this.sidebarVisible = !this.sidebarVisible
			}
        },
		computed:{
			cartCount(){
				return this.veges.reduce((pv,cv)=>cv.quantity>0 ? pv+1:pv,0)
			}
		}
      })
	  
	  app.component('fruitcard',{
		  template:`<div class="card">
            <div class="card-title">
              {{vege.name}}
            </div>
            <div class="card-body">
              <i :class="icon"></i>
              <form>
                <div class="row">
                  <div class="cell">
                    <label>Type:</label>
                  </div>
                  <div class="cell">
                    <em>{{vege.type}}</em>
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Price:</label>
                  </div>
                  <div class="cell">
                    {{vege.price}}
                  </div>
                </div>
                <div class="row">
                  <div class="cell">
                    <label>Quantity:</label>
                  </div>
                  <div class="cell">
                    <input type="number" v-model.number="vege.inventory">
                  </div>
                </div>
              </form>
            </div>
            <div class="card-footer">
              <button @click="addToCart" class="btn btn-light">
                Add to cart
              </button>
            </div>
          </div>`,
		  props:['vege'],
		  data(){
			  return {
				  icon : "icofont-10x icofont-" + this.vege.icon
			  }
		  },
		  methods : {
			 addToCart() {
            	this.vege.quantity += this.vege.inventory
          	},
		  }
	  })
	app.component('cartproduct',{
		template:`
			<template v-if="cartVisible">
				<tr>
				  <td><i :class=icon></i></td>
				  <td>{{ vege.name}}</td>
				  <td>{{ vege.price}}</td>
				  <td class="center">{{ vege.quantity}}</td>
				  <td>{{ vegetotal }}</td>
				  <td class="center">
					<button @click="rmFromCart" class="btn btn-light cart-remove">
					  &times;
					</button>
				  </td>
				</tr>
	  		</template>
		`,
		props:['vege'],
		computed:{
			vegetotal(){
				return (this.vege.price * this.vege.quantity).toFixed(2)
			},
			cartVisible(){
				return this.vege.quantity > 0
			}
		},
		data(){
			return {
				icon : "icofont-" + this.vege.icon + " icofont-3x",
			}
		},
		methods:{
			rmFromCart(){
				this.vege.quantity = 0
			}
		}
	})
	  app.component('sidebar',{
		  props:['toggle','vegeside'],
		  computed:{
		  	totalPrice() {
		  		return (this.vegeside.reduce((pv,cv)=>pv+(cv.quantity*cv.price),0)).toFixed(2)
	  		},
			
		  },
		  template: `<aside class="cart-container">
						<div class="cart">
						  <h1 class="cart-title spread">
							<span>
							  Cart
							  <i class="icofont-cart-alt icofont-1x"></i>
							</span>
							<button @click="toggle" class="cart-close">&times;</button>
						  </h1>

						  <div class="cart-body">
							<table class="cart-table">
							  <thead>
								<tr>
								  <th><span class="sr-only">Product Image</span></th>
								  <th>Product</th>
								  <th>Price</th>
								  <th>Qty</th>
								  <th>Total</th>
								  <th><span class="sr-only">Actions</span></th>
								</tr>
							  </thead>
							  <tbody>
								<cartproduct v-for="vegetable in vegeside"
									:vege="vegetable"
								/>
							  </tbody>
							</table>

							<p v-if="totalPrice==0" class="center"><em>No items in cart</em></p>
							<div class="spread">
							  <span><strong>Total:</strong>{{totalPrice}}</span>
							  <button class="btn btn-light">Checkout</button>
							</div>
						  </div>
						</div>
					 </aside>`,		  
	  })
      app.mount('#app')
    </script>
  </body>
</html>
